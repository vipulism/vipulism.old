(function(e){"use strict";var n=this,t=n.SpeechRecognition||n.webkitSpeechRecognition||n.mozSpeechRecognition||n.msSpeechRecognition||n.oSpeechRecognition;if(!t)return n.annyang=null,e;var r,o,a=[],i={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},c=0,s=!1,l="font-weight: bold; color: #00f;",u=/\s*\((.*?)\)\s*/g,g=/(\(\?:[^)]+\))\?/g,f=/(\(\?)?:\w+/g,h=/\*\w+/g,m=/[\-{}\[\]+?.,\\\^$|#]/g,d=function(e){return e=e.replace(m,"\\$&").replace(u,"(?:$1)?").replace(f,function(e,n){return n?e:"([^\\s]+)"}).replace(h,"(.*?)").replace(g,"\\s*$1?\\s*"),new RegExp("^"+e+"$","i")},p=function(e){e.forEach(function(e){e.callback.apply(e.context)})},w=function(){r===e&&n.annyang.init({},!1)};n.annyang={init:function(u,g){g=g===e?!0:!!g,r&&r.abort&&r.abort(),r=new t,r.maxAlternatives=5,r.continuous=!0,r.lang="en-US",r.onstart=function(){p(i.start)},r.onerror=function(e){switch(p(i.error),e.error){case"network":p(i.errorNetwork);break;case"not-allowed":case"service-not-allowed":o=!1,p((new Date).getTime()-c<200?i.errorPermissionBlocked:i.errorPermissionDenied)}},r.onend=function(){if(p(i.end),o){var e=(new Date).getTime()-c;1e3>e?setTimeout(n.annyang.start,1e3-e):n.annyang.start()}},r.onresult=function(e){p(i.result);for(var t,r=e.results[e.resultIndex],o=0;o<r.length;o++){t=r[o].transcript.trim(),s&&n.console.log("Speech recognized: %c"+t,l);for(var c=0,u=a.length;u>c;c++){var g=a[c].command.exec(t);if(g){var f=g.slice(1);return s&&(n.console.log("command matched: %c"+a[c].originalPhrase,l),f.length&&n.console.log("with parameters",f)),a[c].callback.apply(this,f),p(i.resultMatch),!0}}}return p(i.resultNoMatch),!1},g&&(a=[]),u.length&&this.addCommands(u)},start:function(n){w(),n=n||{},o=n.autoRestart!==e?!!n.autoRestart:!0,c=(new Date).getTime(),r.start()},abort:function(){w(),o=!1,r.abort()},debug:function(e){s=arguments.length>0?!!e:!0},setLanguage:function(e){w(),r.lang=e},addCommands:function(e){var t,r;w();for(var o in e)if(e.hasOwnProperty(o)){if(t=n[e[o]]||e[o],"function"!=typeof t)continue;r=d(o),a.push({command:r,callback:t,originalPhrase:o})}s&&n.console.log("Commands successfully loaded: %c"+a.length,l)},removeCommands:function(e){e=Array.isArray(e)?e:[e],a=a.filter(function(n){for(var t=0;t<e.length;t++)if(e[t]===n.originalPhrase)return!1;return!0})},addCallback:function(t,r,o){if(i[t]!==e){var a=n[r]||r;"function"==typeof a&&i[t].push({callback:a,context:o||this})}}}}).call(this);